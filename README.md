# re2go Slow Issue

This repository contains code sample for cases where code generated by re2go is magnitude slower than Go's standard `regexp` library.

To run this repository, you can use `make` command or `go run *.go`. Here is the result when run in my PC running Linux with Intel i7-8550U and RAM 16 GB:

```
File "sample/01.html"
  Go std regex     : 20,654 µs
  re2go custom     : 9,975,617 µs (482x slower)
  re2go sentinel   : 8,570,601 µs (414x slower)
  re2go sentinel BV: 2,343,542 µs (113x slower)
  re2go 2 rules    : 4,679 µs (4x faster)
  re2go 2 rules BV : 5,155 µs (4x faster)
  re2go 3 rules    : 4,705 µs (4x faster)
  re2go 3 rules BV : 6,839 µs (3x faster)

File "sample/02.html"
  Go std regex     : 19,618 µs
  re2go custom     : 8,544,522 µs (435x slower)
  re2go sentinel   : 6,828,683 µs (348x slower)
  re2go sentinel BV: 2,073,193 µs (105x slower)
  re2go 2 rules    : 2,963 µs (6x faster)
  re2go 2 rules BV : 2,661 µs (7x faster)
  re2go 3 rules    : 2,507 µs (7x faster)
  re2go 3 rules BV : 4,235 µs (4x faster)

File "sample/03.html"
  Go std regex     : 21,788 µs
  re2go custom     : 2,214,779 µs (101x slower)
  re2go sentinel   : 1,502,531 µs (68x slower)
  re2go sentinel BV: 642,667 µs (29x slower)
  re2go 2 rules    : 2,428 µs (8x faster)
  re2go 2 rules BV : 1,759 µs (12x faster)
  re2go 3 rules    : 2,591 µs (8x faster)
  re2go 3 rules BV : 2,542 µs (8x faster)

File "sample/04.html"
  Go std regex     : 19,944 µs
  re2go custom     : 1,123,340 µs (56x slower)
  re2go sentinel   : 811,518 µs (40x slower)
  re2go sentinel BV: 371,667 µs (18x slower)
  re2go 2 rules    : 772,873 µs (38x slower)
  re2go 2 rules BV : 364,357 µs (18x slower)
  re2go 3 rules    : 4,572 µs (4x faster)
  re2go 3 rules BV : 7,619 µs (2x faster)

File "sample/05.html"
  Go std regex     : 8,585 µs
  re2go custom     : 4,371 µs (1x faster)
  re2go sentinel   : 3,261 µs (2x faster)
  re2go sentinel BV: 493 µs (17x faster)
  re2go 2 rules    : 3,079 µs (2x faster)
  re2go 2 rules BV : 509 µs (16x faster)
  re2go 3 rules    : 3,301 µs (2x faster)
  re2go 3 rules BV : 689 µs (12x faster)

File "sample/06.html"
  Go std regex     : 8,690 µs
  re2go custom     : 12,951 µs (1x slower)
  re2go sentinel   : 9,488 µs (1x slower)
  re2go sentinel BV: 6,960 µs (1x faster)
  re2go 2 rules    : 9,086 µs (1x slower)
  re2go 2 rules BV : 7,932 µs (1x faster)
  re2go 3 rules    : 2,674 µs (3x faster)
  re2go 3 rules BV : 3,838 µs (2x faster)

File "sample/07.html"
  Go std regex     : 78,352 µs
  re2go custom     : 55,233 µs (1x faster)
  re2go sentinel   : 31,518 µs (2x faster)
  re2go sentinel BV: 27,455 µs (2x faster)
  re2go 2 rules    : 24,278 µs (3x faster)
  re2go 2 rules BV : 25,478 µs (3x faster)
  re2go 3 rules    : 23,033 µs (3x faster)
  re2go 3 rules BV : 36,690 µs (2x faster)
```

### Code Summary

The main code is available in `main.go`. Thanks to Go nature, I believe the code is readable and easy enough to understand. However, for clarity here I write a short summary about this code.

In short, I'm using the following regex pattern to find emails in web pages:

```
[\+\-\.0-9A-Z_a-z]+@[\-\.0-9A-Z_a-z]+[\.][\-\.0-9A-Z_a-z]+
```

For Go's standard library, the regex is generated simply by running `regexp.MustCompile`:

```go
var rxEmail = regexp.MustCompile(`[\+\-\.0-9A-Z_a-z]+@[\-\.0-9A-Z_a-z]+[\.][\-\.0-9A-Z_a-z]+`)
```

For re2go, the code is generated by two `.re` templates, one uses custom check for handling end input, and the other one uses sentinel with bound checks. The templates then compiled by re2go using following command (see `Makefile` for more detail):

```
re2go -F --input-encoding utf8 --utf8 --no-generation-date -i $INPUT -o $OUTPUT
```

The generated code then compared with Go's standard regexp library using several web pages in [sample](./sample/) directory.

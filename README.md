# re2go Slow Issue

This repository contains code sample for cases where code generated by re2go is magnitude slower than Go's standard `regexp` library.

To run this repository, you can use `make` command or `go run *.go`. Here is the result when run in my PC running Linux with Intel i7-8550U and RAM 16 GB:

```
File "sample/01.html"
  Go std regex        : found 0 matches in 20 ms
  re2go custom check  : found 0 matches in 9697 ms (484x slower)
  re2go sentinel bound: found 0 matches in 7677 ms (383x slower)

File "sample/02.html"
  Go std regex        : found 0 matches in 15 ms
  re2go custom check  : found 0 matches in 7638 ms (509x slower)
  re2go sentinel bound: found 0 matches in 6200 ms (413x slower)

File "sample/03.html"
  Go std regex        : found 0 matches in 13 ms
  re2go custom check  : found 0 matches in 1918 ms (147x slower)
  re2go sentinel bound: found 0 matches in 1471 ms (113x slower)

File "sample/04.html"
  Go std regex        : found 0 matches in 17 ms
  re2go custom check  : found 0 matches in 1063 ms (62x slower)
  re2go sentinel bound: found 0 matches in 736 ms (43x slower)
```

### Code Summary

The main code is available in `main.go`. Thanks to Go nature, I believe the code is readable and easy enough to understand. However, for clarity here I write a short summary about this code.

In short, I'm using the following regex pattern to find emails in web pages:

```
[\+\-\.0-9A-Z_a-z]+@[\-\.0-9A-Z_a-z]+[\.][\-\.0-9A-Z_a-z]+
```

For Go's standard library, the regex is generated simply by running `regexp.MustCompile`:

```go
var rxEmail = regexp.MustCompile(`[\+\-\.0-9A-Z_a-z]+@[\-\.0-9A-Z_a-z]+[\.][\-\.0-9A-Z_a-z]+`)
```

For re2go, the code is generated by two `.re` templates, one uses custom check for handling end input, and the other one uses sentinel with bound checks. The templates then compiled by re2go using following command (see `Makefile` for more detail):

```
re2go -F --input-encoding utf8 --utf8 --no-generation-date -i $INPUT -o $OUTPUT
```

The generated code then compared with Go's standard regexp library using several web pages in [sample](./sample/) directory.

# re2go Slow Issue

This repository contains code sample for cases where code generated by re2go is magnitude slower than Go's standard `regexp` library.

To run this repository, you can use `make` command or `go run *.go`. Here is the result when run in my PC running Linux with Intel i7-8550U and RAM 16 GB:

```
File "sample/01.html"
  Go std regex     : 20,536 µs
  re2go custom     : 9,724,611 µs (473x slower)
  re2go sentinel   : 7,793,693 µs (379x slower)
  re2go sentinel BV: 2,085,287 µs (101x slower)
  re2go 2 rules    : 4,554 µs (4x faster)
  re2go 2 rules BV : 4,591 µs (4x faster)
  re2go 3 rules    : 4,247 µs (4x faster)
  re2go 3 rules BV : 6,401 µs (3x faster)

File "sample/02.html"
  Go std regex     : 15,292 µs
  re2go custom     : 7,709,193 µs (504x slower)
  re2go sentinel   : 6,145,609 µs (401x slower)
  re2go sentinel BV: 1,806,896 µs (118x slower)
  re2go 2 rules    : 2,392 µs (6x faster)
  re2go 2 rules BV : 2,320 µs (6x faster)
  re2go 3 rules    : 2,291 µs (6x faster)
  re2go 3 rules BV : 3,865 µs (3x faster)

File "sample/03.html"
  Go std regex     : 13,901 µs
  re2go custom     : 1,936,579 µs (139x slower)
  re2go sentinel   : 1,444,875 µs (103x slower)
  re2go sentinel BV: 590,062 µs (42x slower)
  re2go 2 rules    : 2,135 µs (6x faster)
  re2go 2 rules BV : 1,529 µs (9x faster)
  re2go 3 rules    : 2,223 µs (6x faster)
  re2go 3 rules BV : 2,260 µs (6x faster)

File "sample/04.html"
  Go std regex     : 17,347 µs
  re2go custom     : 1,070,713 µs (61x slower)
  re2go sentinel   : 731,417 µs (42x slower)
  re2go sentinel BV: 312,772 µs (18x slower)
  re2go 2 rules    : 713,930 µs (41x slower)
  re2go 2 rules BV : 342,316 µs (19x slower)
  re2go 3 rules    : 4,749 µs (3x faster)
  re2go 3 rules BV : 6,968 µs (2x faster)
```

### Code Summary

The main code is available in `main.go`. Thanks to Go nature, I believe the code is readable and easy enough to understand. However, for clarity here I write a short summary about this code.

In short, I'm using the following regex pattern to find emails in web pages:

```
[\+\-\.0-9A-Z_a-z]+@[\-\.0-9A-Z_a-z]+[\.][\-\.0-9A-Z_a-z]+
```

For Go's standard library, the regex is generated simply by running `regexp.MustCompile`:

```go
var rxEmail = regexp.MustCompile(`[\+\-\.0-9A-Z_a-z]+@[\-\.0-9A-Z_a-z]+[\.][\-\.0-9A-Z_a-z]+`)
```

For re2go, the code is generated by two `.re` templates, one uses custom check for handling end input, and the other one uses sentinel with bound checks. The templates then compiled by re2go using following command (see `Makefile` for more detail):

```
re2go -F --input-encoding utf8 --utf8 --no-generation-date -i $INPUT -o $OUTPUT
```

The generated code then compared with Go's standard regexp library using several web pages in [sample](./sample/) directory.
